{% from "components/site.html" import
padding,
ModuleHeading,
ModuleSectionHeading,
Capsule,
genericDemo,
paddingDemo,
marginDemo,
DisplayValue,
BoxSelectionResultDemo %}

{% set durations = tw.global.transitionDuration %}
{% set durationsListLength = durations | length %}
{% set easings = tw.global.transitionTimingFunction %}

{{ ModuleHeading('transitions') }}

<div class="flex w-full">
  <div class="flex-grow max-w-full">
    <article class="{{ padding() }}" x-data="Transitions()" x-init="init()">
      {{ ModuleSectionHeading('Transition duration', 'https://tailwindcss.com/docs/margin') }}

      <div class="flex flex-wrap justify-between px-2 mt-8">
        <svg class="w-16 h-16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 33 33">
          <circle cx="12.1439" cy="15.4642" r="10.3746" fill="#F59E0B"/>
          <path fill="#4B5563" fill-rule="evenodd" d="M11.8958 14.765c-.9241 1.2178-1.7968 2.368-2.0946 3.8423-.3489 1.727-.0386 3.4027.8739 4.7186 1.0698 1.5431 2.8789 2.5349 5.3769 2.9493.4362.3425.9389.6388 1.4953.8496l.0091.0037c.0048.0018.0098.003.0147.0042l.0081.002.0063.0019c.0044.0013.0086.0026.0132.0035a.2544.2544 0 0 0 .0489.005l.0009-.0001h3.3935a.259.259 0 0 0 .259-.2585c.0008-.4066-.1637-.7008-.3976-.922a6.8742 6.8742 0 0 0 1.0572-.5724l.2992 1.5431a.2591.2591 0 0 0 .2543.2098H26.99a.259.259 0 0 0 .259-.259c0-.6438-.5085-1.2301-1.2394-1.4642l.9136-5.7738c.364-.9364.5705-1.7822.7201-2.3952l.0162-.0661a83.252 83.252 0 0 1 2.1791-1.5301l.0219-.0149c.0723-.0489.1441-.0972.2153-.145l.0473-.0318c.0713-.0477.142-.0949.212-.1414l.0175-.0116c.0776-.0515.1545-.1022.2302-.1519a.2592.2592 0 0 0 .1142-.2541l-.0002-.0013a6.7655 6.7655 0 0 0-.0404-.2424l-.0057-.0304c-.1091-.581-.2902-1.1273-.5414-1.6323.4409-.8727 1.0668-2.788.5357-3.3191-.5075-.5074-2.2898.0318-3.28.5174l-.4184.0465h-.0238a4.6541 4.6541 0 0 0-1.3107-.1885c-.4519 0-.8908.0658-1.3099.1885h-.0444l-.2922-.0325c-.984-.4891-2.7959-1.0438-3.3083-.5315-.5169.517.0588 2.3362.4983 3.2434-.2722.5269-.467 1.098-.5817 1.7062l-.0048.0259-.0015.0083a6.9913 6.9913 0 0 0-.0403.2416.259.259 0 0 0 .1142.2541c.1922.126.487.3215.8596.5748-1.2031.8586-2.2225 1.5149-2.761 1.776l-.1621.0701c-1.3497.5685-2.3929 1.2318-3.1298 1.9856.083-.3666.2149-.7233.3978-1.0768.7879-1.5227 1.1945-3.1674 1.1447-4.6309-.0614-1.8118-.8256-3.2801-2.2096-4.2464a.259.259 0 0 0-.4046.1755c-.3032 2.1073-1.4103 3.5665-2.4807 4.9773Z" clip-rule="evenodd"/>
        </svg>

        <svg class="w-16 h-16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 32 33">
          <circle cx="19.0447" cy="15.2391" r="11.9058" fill="#34D399"/>
          <path fill="#4B5563" fill-rule="evenodd" d="M25.6971 19.9236c-.2627-2.218-1.3074-4.2644-2.9622-5.7881-1.7356-1.5979-3.9914-2.478-6.3523-2.478-4.6828 0-8.5754 3.4494-9.27 7.9409-.5105-1.0596-1.5962-1.7796-2.8247-1.7796a3.1303 3.1303 0 0 0-3.084 2.5801l-.1345.75a1.2739 1.2739 0 0 0 .009.4961c.0432.198.1338.3848.2676.5447.2422.2895.5979.4558.9756.4558H7.003v2.8013l-.708 1.2199a.3121.3121 0 0 0 .2698.4686h5.2399a.312.312 0 0 0 .312-.3118v-2.502c1.3838.25 2.8499.3765 4.3145.3765 1.4365 0 2.8694-.1218 4.2183-.3628v1.1116l-.708 1.2199a.3102.3102 0 0 0-.0386.1106.3114.3114 0 0 0 .164.3226.3123.3123 0 0 0 .1443.0354h5.24a.3106.3106 0 0 0 .2207-.0916.3112.3112 0 0 0 .0911-.2202v-4.1819c.7158-.0391 1.2864-.6321 1.2864-1.3572 0-.7475-.6057-1.3559-1.3523-1.3608Z" clip-rule="evenodd"/>
        </svg,class=>
        <span class="block w-full h-1 rounded-full bg-gradient-to-r from-red-400 via-yellow-400 to-green-400"></span>
      </div>

      <div data-io-root class="relative overflow-hidden">
        <div data-io-shadow="start" class="absolute top-0 z-20 w-2 h-full -left-2"></div>
        <div class="w-full h-20 overflow-x-auto">
          <fieldset class="flex items-center h-full text-sm">
            {% for key, value in durations %}
              {% if key !== 'DEFAULT' %}
                <button
                @click="setDuration( {{ key|safe }} )"
                {% if loop.first %}data-io-target="start"{% endif %}
                {% if loop.last - 1 %}data-io-target="end"{% endif %}
                class="{{ isDefaultValue }} flex-grow z-10 w-32 px-4 py-2 m-2 font-bold tracking-wider text-center uppercase transition-all duration-100 bg-white border-2 border-transparent rounded cursor-pointer ease hover:border-green-400"
                :class="{ 'bg-blue-600 text-white shadow-inset': currentDuration === {{ key|safe }}, 'text-gray-400 active shadow-lg': currentDuration !== {{ key|safe }} }">
                  {{- key -}}
                  <span class="font-normal lowercase">ms</span>
                </button>
              {% endif %}
            {% endfor %}
          </fieldset>
        </div>
        <div data-io-shadow="end" class="absolute top-0 z-20 block w-2 h-full -right-2"></div>
      </div>

      {% for key, value in easings %}
        <div x-data="{ isPlaying: false }" class="w-full mt-8">
          <div @click="isPlaying = !isPlaying"
            class="relative flex items-center flex-grow w-full h-20 hover:cursor-pointer lg:order-last">
            <span class="absolute inset-x-0 block w-full h-20 text-xs text-center text-gray-400">{{ value }}</span>
            <span class="absolute w-full h-px -translate-y-1/2 bg-gray-300 top-1/2"></span>
            <div
              :style="{ animationDuration: `${currentDuration}ms`,  animationTimingFunction: `{{ key }}`, animationIterationCount: `${currentIterationCount}` }"
                :class="{ 'animate-active' : isPlaying }"
                class="absolute animate-horz transform top-1/2 -translate-y-1/2 w-16 h-16 rounded-full transition-all bg-blue-400 ease-{{ key }}"></div>
          </div>
          <div class="flex overflow-hidden">
            <span class="px-3 py-1 font-mono text-xs text-center text-gray-100 bg-gray-500 border border-gray-800 rounded-l">easing-{{ key }}</span>
            <span class="px-3 py-1 -ml-px font-mono text-xs text-center border border-gray-800 rounded-r bg-gray-50 border-l-none">{{ value }}</span>
          </div>
          <div class="flex items-start justify-between mt-3">
            {# <div class="w-1/3">{{ Capsule( ['ease-', key] | join('') ) }}</div> #}

            <button
        @click="playAnimation()"
        type="button">Play</button>
            <button
        @click="loopAnimation()"
        type="button">Loop</button>
          </div>
        </div>
      {% endfor %}
    </article>
  </div>
  <aside class="{{ padding() }} flex-shrink-0 flex-grow-0 h-screen w-64 xl:w-80 3xl:w-96"></aside>
</div>

<script>
  function Transitions() {
    return {
      isPlaying: false,
      defaultDuration: 150,
      currentDuration: 150,
      currentIterationCount: 1,
      init() {
        this.setDuration(150)
        this.setIterationCount(1)
      },
      startAnimation() {
        this.isPlaying = true
      },
      stopAnimation() {
        this.isPlaying = false
      },
      toggleAnimation() {
        this.isPlaying = !this.isPlaying
      },
      playAnimation() {
        this.setIterationCount(1)
        this.startAnimation()
        setTimeout(() => {
          this.stopAnimation()
        }, this.currentDuration)
      },
      loopAnimation() {
        this.setIterationCount('infinite')
        this.toggleAnimation()
      },
      setDuration(duration) {
        this.currentDuration = duration
      },
      setIterationCount(count) {
        this.currentIterationCount = count

      }
    }
  }
  const ioOptions = {
    root: document.querySelector('[data-io-root]'),
    rootMargin: '',
    threshold: [0, 0.25, 0.5, 0.75, 1]
  }

  const shadowStart = document.querySelector('[data-io-shadow="start"]')
  const shadowEnd = document.querySelector('[data-io-shadow="end"]')
  const toggleShadows = (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.intersectionRatio < 0 || entry.intersectionRatio > 0.5) {
        console.warn(entry.target.dataset.ioTarget)
        document
          .querySelector(`[data-io-shadow="${entry.target.dataset.ioTarget}"]`)
          .classList
          .remove('io-shadow')
      } else {
        console.warn(entry.target.dataset.ioTarget)
        document
          .querySelector(`[data-io-shadow="${entry.target.dataset.ioTarget}"]`)
          .classList
          .add('io-shadow')
      }
    })
  }

  const observer = new IntersectionObserver(toggleShadows, ioOptions)
  const targetEls = [...document.querySelectorAll('[data-io-target]')]
  targetEls.forEach((el) => {
    observer.observe(el)
  })
</script>